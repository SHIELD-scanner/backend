from typing import List, Optional

from fastapi import APIRouter, Query, Depends

from app.core.old_vulnerabilityClient import VulnerabilityClient
from app.models.old_vulnerability import Vulnerability

router = APIRouter()


def get_vulnerability_client() -> VulnerabilityClient:
    """Dependency to get VulnerabilityClient instance."""
    return VulnerabilityClient()


@router.get("/", response_model=List[Vulnerability])
def list_vulnerabilities(
    namespace: Optional[str] = Query(None),
    cluster: Optional[str] = Query(None),
    severity: Optional[str] = Query(None),
    db: VulnerabilityClient = Depends(get_vulnerability_client)
):
    """List all vulnerabilities in the cluster."""
    return db.get_all(namespace=namespace, cluster=cluster, severity=severity)


@router.get("/{hash}", response_model=Vulnerability)
def show_vulnerability(
    hash: str,
    db: VulnerabilityClient = Depends(get_vulnerability_client)
):
    """Show a specific vulnerability by hash."""
    return db.get_by_hash(hash)
